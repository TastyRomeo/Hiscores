<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <title>10HP HiScores</title>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="shortcut icon" type="image/png" href="img/favicon.png">
    <style>
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-weight: bold;
        text-align: center;
      }
      #page {
        background-color: #34353f;
        width: 1100px;
        margin: 0 auto 0 auto;
        min-height: calc(100vh - 10px);
        padding: 5px 15px 5px 15px;
      }
      #tableContainer {
        width: 1000px;
        margin: 25px auto 25px auto;
      }
      table.dataTable td,th {
        font-size: small;
        font-family: Courier New;
        min-width: 100px;
      }
      body {
        background-color: #23242e;
        color: #f7f6f1;
        margin: 0;
      }
    </style>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script>
      var table;
      $(function(){
        $.get({url:"data/hiscores.csv",cache:false,success:function(data) {
          let csv = [];
          let entries = data.split('\n');
          entries.pop()
          for(let i in entries){
            csv[i] = entries[i].split(',');
          }
          table = $('#hiscoreTable').DataTable({
            orderMulti: false,
            autoWidth: false,
            language: {
              decimal: ".",
              thousands: ","
            },
            order: [[3,'desc']],
            columns: [
              { 
                title: "Display Name", // 0. Display Name
                className: "dt-body-left dt-head-center",
                orderable: false,
                type: 'string'
              },
              { 
                title: "HP Lvl", // 1. HP Lvl
                className: "dt-body-right dt-head-center",
                orderable: false,
                visible: false,
                type: 'num'
              },
              { 
                title: "HP XP", // 2. HP XP
                className: "dt-body-right dt-head-center",
                orderable: false,
                visible: false,
                render: function( data, type, row ) {
                  return parseInt(data).toLocaleString('en-US');
                },
                type: 'num-fmt'
              },
              { 
                title: "Total Lvl", // 3. Total Lvl
                className: "dt-body-right dt-head-center",
                orderSequence: ['desc'],
                orderData: [4,8],
                render: function( data, type, row ) {
                  return parseInt(data).toLocaleString('en-US');
                },
                type: 'num-fmt'
                
              },
              { 
                title: "Total Lvl (adjusted)", // 4. Total Lvl - HP Lvl
                className: "dt-body-right dt-head-center",
                orderSequence: ['desc'],
                visible: false,
                render: function( data, type, row ) {
                  return parseInt(data).toLocaleString('en-US');
                },
                type: 'num-fmt'
                
              },
              { 
                title: "Total Lvl", // 5. Virtual Total Lvl
                className: "dt-body-right dt-head-center",
                orderSequence: ['desc'],
                orderData: [6,8],
                visible: false,
                render: function( data, type, row ) {
                  return parseInt(data).toLocaleString('en-US');
                },
                type: 'num-fmt'
              },
              { 
                title: "Total Lvl (adjusted)", // 6. Virtual Total Lvl - HP Lvl
                className: "dt-body-right dt-head-center",
                orderSequence: ['desc'],
                visible: false,
                render: function( data, type, row ) {
                  return parseInt(data).toLocaleString('en-US');
                },
                type: 'num-fmt'
              },
              { 
                title: "Total XP", // 7. Total XP
                className: "dt-body-right dt-head-center",
                orderSequence: ['desc'],
                orderData: [8],
                render: function( data, type, row ) {
                  return parseInt(data).toLocaleString('en-US');
                },
                width: "110px",
                type: 'num-fmt'
              },
              { 
                title: "Total XP (adjusted)", // 8. Total XP - HP XP
                className: "dt-body-right dt-head-center",
                orderSequence: ['desc'],
                visible: false,
                render: function( data, type, row ) {
                  return parseInt(data).toLocaleString('en-US');
                },
                type: 'num-fmt'
              },
              { 
                title: "Combat Lvl", // 9. Combat Lvl
                className: "dt-body-right dt-head-center",
                orderSequence: ['desc'],
                orderData: [10],
                render: function( data, type, row ) {
                  return parseInt(data).toLocaleString('en-US');
                },
                type: 'num-fmt'
              },
              { 
                title: "Combat Lvl (adjusted)", // 10. Combat Lvl adjusted for HP
                className: "dt-body-right dt-head-center",
                orderSequence: ['desc'],
                visible: false,
                render: function( data, type, row ) {
                  return parseInt(data).toLocaleString('en-US');
                },
                type: 'num-fmt'
              },
              { 
                title: "RuneScore", // 11. RuneScore
                className: "dt-body-right dt-head-center",
                orderSequence: ['desc'],
                orderData: [11,8,12],
                render: function( data, type, row ) {
                  if (data!="") {
                    return parseInt(data).toLocaleString('en-US');
                  } else {
                    return "";
                  }
                },
                type: 'num-fmt'
              },
              { 
                title: "Quest Pts", // 12. Quest Points
                className: "dt-body-right dt-head-center",
                orderSequence: ['desc'],
                orderData: [12,8,11],
                type: 'num-fmt'
              },
            ],
            data: csv
          });
        }});
        $('input[name="showConstitution"]').change(function () {
          let column1 = table.column(1);
          let column2 = table.column(2);
          column1.visible(!column1.visible());
          column2.visible(!column2.visible());
        });
        $('input[name="useVirtual"]').change(function () {
          let column3 = table.column(3);
          let column4 = table.column(4);
          column3.visible(!column3.visible());
          column4.visible(!column4.visible());
          orderNr = table.order()[0][0];
          if ([3,4].includes(orderNr)) {
            table.order([[3+(orderNr%2),"desc"]]).draw()
          }
        });
        /*
        $('input[name="fracshow"]').change(function () {
          if ($('input[name="fracshow"]').is(":checked")) {
            table.rows().every(function(rowIndex){
              table.columns().every(function(colIndex){
                let cell = table.cell({row:rowIndex,column:colIndex})
                let span = cell.nodes().toJQuery().find('.frac')
                span.removeClass("hidden")
              });
            });
          }
          else {
            table.rows().every(function(rowIndex){
              table.columns().every(function(colIndex){
                let cell = table.cell({row:rowIndex,column:colIndex})
                let span = cell.nodes().toJQuery().find('.frac')
                span.addClass("hidden")
              });
            });
          }
        });*/
      });
    </script>
  </head>
  <body>
    <div id="page">
      <h1>10HP Hiscores</h1>
      <input type="checkbox" id='useVirtual' name="useVirtual" /><label for="useVirtual">Toggle virtual levelling</label><br />
      <input type="checkbox" id='showConstitution' name="showConstitution" /><label for="showConstitution">Toggle Constitution info</label><br />
      <div id="tableContainer"><table border=1 id="hiscoreTable"></table></div>
      <!--<input type="checkbox" id='fracshow' name="fracshow" /><label for="fracshow">Show decimals</label>-->
      Requirements to be ranked:
      <ul>
        <li>Constitution is at most level 15 (i.e. can be reset by Nastroth)</li>
        <li>At least one combat skill is above level 10 (i.e. cannot be reset by Nastroth)</li>
        <li>All skills except Constitution must be ranked on the HiScores, or RuneMetrics must be public</li>
        <li>Username is being tracked </li>
      </ul>
      Some details:
      <ul>
        <li>Constitution levels and xp are subtracted (i.e. Constitution level is assumed to be 1, Constitution XP is assumed to be 0)</li>
        <li>RuneScore is only available when ranked on the HiScores</li>
        <li>Quest Points are only available when RuneMetrics is public</li>
      </ul>
    </div>
  </body>
</html>
