<html>
  <head>
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <style>
      .hidden { display: none }
    </style>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script>
      var table;
      $(function(){
        $.get({url:"data/hiscores.csv",cache:false,success:function(data) {
          let csv = [];
          let entries = data.split('\n');
          entries.pop()
          for(let i in entries){
            csv[i] = entries[i].split(',');
          }
          table = $('#myTable').DataTable( {
            language: {
              decimal: ".",
              thousands: ","
            },
            order: [[5, 'desc'],[6, 'desc'],[0,'asc']],
            columns: [
              { 
                title: "Display Name",
                className: "dt-body-left dt-head-center",
                orderable: false,
                type: 'string'
              },
              { 
                title: "Constitution Level",
                className: "dt-body-right dt-head-center",
                orderable: false,
                type: 'num'
              },
              { 
                title: "Constitution XP",
                className: "dt-body-right dt-head-center",
                orderable: false,
                render: function( data, type, row ) {
                  return parseInt(data).toLocaleString('en-US');
                },
                type: 'num-fmt'
              },
              { 
                title: "Total Level",
                className: "dt-body-right dt-head-center",
                orderSequence: ['desc'],
                orderData: [3,4,5,0],
                render: function( data, type, row ) {
                  return parseInt(data).toLocaleString('en-US');
                },
                type: 'num-fmt'
                
              },
              { 
                title: "Virtual Total Level",
                className: "dt-body-right dt-head-center",
                orderSequence: ['desc'],
                orderData: [4,5,0],
                render: function( data, type, row ) {
                  return parseInt(data).toLocaleString('en-US');
                }
              },
              { 
                title: "Total XP",
                className: "dt-body-right dt-head-center",
                orderSequence: ['desc'],
                orderData: [5,0],
                render: function( data, type, row ) {
                  return parseInt(data).toLocaleString('en-US');
                },
                type: 'num-fmt'
              },
              { 
                title: "RuneScore",
                className: "dt-body-right dt-head-center",
                orderSequence: ['desc'],
                orderData: [6,0],
                render: function( data, type, row ) {
                  if (data!="") {
                    return parseInt(data).toLocaleString('en-US');
                  } else {
                    return "";
                  }
                },
                type: 'num-fmt'
              },
              { 
                title: "Quest Points",
                className: "dt-body-right dt-head-center",
                orderSequence: ['desc'],
                orderData: [7,0],
                type: 'num-fmt'
              },
            ],
            data: csv
          });
        }});
        /*
        $('input[name="fracshow"]').change(function () {
          if ($('input[name="fracshow"]').is(":checked")) {
            table.rows().every(function(rowIndex){
              table.columns().every(function(colIndex){
                let cell = table.cell({row:rowIndex,column:colIndex})
                let span = cell.nodes().toJQuery().find('.frac')
                span.removeClass("hidden")
              });
            });
          }
          else {
            table.rows().every(function(rowIndex){
              table.columns().every(function(colIndex){
                let cell = table.cell({row:rowIndex,column:colIndex})
                let span = cell.nodes().toJQuery().find('.frac')
                span.addClass("hidden")
              });
            });
          }
        });*/
      });
    </script>
  </head>
  <body>
    <h3 class="panel-title">10HP Hiscores</h3>
    <table border=1 id="myTable"></table>
    <!--<input type="checkbox" id='fracshow' name="fracshow" /><label for="fracshow">Show decimals</label>-->
    Requirements to be ranked:
    <ul>
      <li>Constitution is at most level 15 (i.e. can be reset by Nastroth)</li>
      <li>At least one combat skill is above level 10 (i.e. cannot be reset by Nastroth)</li>
      <li>All skills except Constitution must be ranked on the HiScores, or RuneMetrics must be public</li>
      <li>Username is being tracked (easily adding usernames is WIP)</li>
    </ul>
    Some other facts:
    <ul>
      <li>Constitution levels and xp are subtracted from other columns</li>
      <li>RuneScore is only available when ranked on the HiScores</li>
      <li>Quest Points are only available when RuneMetrics is public</li>
    </ul>
  </body>
</html>
